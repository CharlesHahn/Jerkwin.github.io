function EditTables(){for(var a=0;a<arguments.length;a++)SetTableCanEdit(arguments[a])}function SetTableCanEdit(a){for(var b=1;b<a.rows.length;b++)SetRowCanEdit(a.rows[b])}function SetRowCanEdit(a){var b,c;for(b=0;b<a.cells.length;b++)c=a.cells[b].getAttribute("EditType"),c||(c=a.parentNode.rows[0].cells[b].getAttribute("EditType")),c&&(a.cells[b].onclick=function(){EditCell(this)})}function EditCell(a,b){var b=a.getAttribute("EditType");switch(b||(b=a.parentNode.parentNode.rows[0].cells[a.cellIndex].getAttribute("EditType")),b){case"TextBox":CreateTextBox(a,a.innerHTML);break;case"DropDownList":CreateDropDownList(a)}}function CreateTextBox(a,b){var d,c=a.getAttribute("EditState");"true"!=c&&(d=document.createElement("INPUT"),d.type="text",d.className="EditCell_TextBox",b||(b=a.getAttribute("Value")),d.value=b,d.onblur=function(){CancelEditCell(this.parentNode,this.value)},ClearChild(a),a.appendChild(d),d.focus(),d.select(),a.setAttribute("EditState","true"),a.parentNode.parentNode.setAttribute("CurrentRow",a.parentNode.rowIndex))}function CreateDropDownList(element,value){var downList,items,i,oOption,editState=element.getAttribute("EditState");if("true"!=editState){if(downList=document.createElement("Select"),downList.className="EditCell_DropDownList",items=element.getAttribute("DataItems"),items||(items=element.parentNode.parentNode.rows[0].cells[element.cellIndex].getAttribute("DataItems")),items)for(items=eval("["+items+"]"),i=0;i<items.length;i++)oOption=document.createElement("OPTION"),oOption.text=items[i].text,oOption.value=items[i].value,downList.options.add(oOption);value||(value=element.getAttribute("Value")),downList.value=value,downList.onblur=function(){CancelEditCell(this.parentNode,this.value,this.options[this.selectedIndex].text)},ClearChild(element),element.appendChild(downList),downList.focus(),element.setAttribute("EditState","true"),element.parentNode.parentNode.setAttribute("LastEditRow",element.parentNode.rowIndex)}}function CancelEditCell(a,b,c){a.setAttribute("Value",b),a.innerHTML=c?c:b,a.setAttribute("EditState","false"),CheckExpression(a.parentNode)}function ClearChild(a){a.innerHTML=""}function AddRow(a){var c=a.rows[a.rows.length-1],d=c.cloneNode(!0);return a.tBodies[0].appendChild(d),SetRowCanEdit(d),d}function DeleteRow(a){var c,d;for(c=a.rows.length-1;c>0;c--)d=a.rows[c].cells[0].firstChild,d&&(d.type="CHECKBOX")&&d.checked&&a.deleteRow(c)}function GetTableData(a){var c,b=new Array;for(alert("行数："+a.rows.length),c=1;c<a.rows.length;c++)b.push(GetRowData(tabProduct.rows[c]));return b}function GetRowData(a){var c,d,b={};for(c=0;c<a.cells.length;c++)name=a.parentNode.rows[0].cells[c].getAttribute("Name"),name&&(d=a.cells[c].getAttribute("Value"),d||(d=a.cells[c].innerHTML),b[name]=d);return b}function CheckExpression(a){var b,d;for(b=0;b<a.cells.length;b++)expn=a.parentNode.rows[0].cells[b].getAttribute("Expression"),expn&&(Expression(a,expn),d=a.parentNode.rows[0].cells[b].getAttribute("Format"),a.cells[b].innerHTML=d?formatNumber(Expression(a,expn),d):Expression(a,expn))}function Expression(row,expn){var j,reg,rowData=GetRowData(row);for(j=0;j<row.cells.length;j++)name=row.parentNode.rows[0].cells[j].getAttribute("Name"),name&&(reg=new RegExp(name,"i"),expn=expn.replace(reg,rowData[name].replace(/\,/g,"")));return expn=expn.replace("ppm",document.getElementById("ppm").value),eval(expn)}function formatNumber(a,b){var j,k,c=a?a.toString().split("."):["0"],d=b?b.split("."):[""],e="",f=c[0],g=d[0],h=f.length-1,i=!1;for(j=g.length-1;j>=0;j--)switch(g.substr(j,1)){case"#":h>=0&&(e=f.substr(h--,1)+e);break;case"0":e=h>=0?f.substr(h--,1)+e:"0"+e;break;case",":i=!0,e=","+e}if(h>=0)if(i)for(k=f.length;h>=0;h--)e=f.substr(h,1)+e,h>0&&0==(k-h)%3&&(e=","+e);else e=f.substr(0,h+1)+e;for(e+=".",f=c.length>1?c[1]:"",g=d.length>1?d[1]:"",h=0,j=0;j<g.length;j++)switch(g.substr(j,1)){case"#":h<f.length&&(e+=f.substr(h++,1));break;case"0":e+=h<f.length?f.substr(h++,1):"0"}return e.replace(/^,+/,"").replace(/\.$/,"")}