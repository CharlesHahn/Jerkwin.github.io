---
 layout: post
 title: GROMACS中文教程
 categories:
 - 科
 tags:
 - GMX
---

<style>
table,th,td,tr { border: none; padding: 5px 2px 0px 2px; }
</style>

## 分子动力学模拟的一般性步骤

以下是分子动力学模拟的一般性步骤, 具体的步骤和过程依赖于你研究的体系和所用的软件, 但这并不影响我们把它当作一个入门指南.

1. __评估体系__ 首先需要对我们要进行模拟的体系做一个简单的评估, 有三个问题是我们必须要明确的:

	![](/GMX/GMXtut-1_question.png)

2. __选择工具__ 选择合适的模拟工具, 大前提是它能够实现你所感兴趣的目标. 这需要你非常广泛谨慎地查阅文献, 看看别人用这些工具都做了些什么, 有没有和你的研究体系类似的, 相关的研究. 千万不要做到一半才发现原来你用的工具根本就不能实现你所感兴趣的idea, 切记!

	在选择合适的模拟工具时, 主要考虑下面两点:

	1. 软件的选择. 通常与软件主流使用的力场有关, 软件本身也具有一定的偏向性.
		- 蛋白体系: GROMACS, AMBER, NAMD均可
		- DNA, RNA体系: 首选AMBER
		- 界面体系: DL_POLY比较强大
		- 材料体系:LAMMPS是不错的选择
	2. 力场的选择. 力场用来描述体系中最小单元间的相互作用, 是对实验性质或量子化学计算结果拟合后生成的经验式. 有人会嫌它粗糙, 但它确确实实为我们模拟大系统提供了可能, 只能说关注的切入点不同罢了. 常见的有三类力场: 全原子力场, 联合力场, 粗粒化力场. 此外还有所谓第一代, 第二代, 第三代力场的说法, 这里就不一一列举了.

	再次提醒注意: 必须选择适合于我们所关注体系和所感兴趣的性质及现象的力场.

3. __初始结构__ 通过实验数据或者某些工具得到体系内的每一个分子的初始结构坐标文件. 之后, 我们需要按我们的想法把这些分子按照一定的规则或是随机的放在一起, 从而得到整个体系的初始结构, 这也是我们模拟的输入文件.

4. __输入参数__ 得到了结构输入文件, 我们还需要力场参数输入文件, 也就是针对我们体系的力场文件. 这通常由所选用的力场决定, 包括电荷, 键合参数和非键参数等势能函数的输入参数.

5. __确定盒子__ 体系的大小通常由你所选用的盒子大小决定. 我们必须对可行性与合理性做出评估, 从而确定体系的大小, 这依赖于具体的体系.

6. __能量最小化__ 由于初始构象可能会存在两个原子靠得太近的情况(称之为bad contact), 所以需要在正式模拟开始的第一步对体系进行能量最小化. 比较常用的能量最小化方法有两种, 最速下降法和共轭梯度法. 最速下降法是快速移除体系内应力的好方法, 但是接近能量极小点时收敛比较慢, 而共轭梯度法在能量极小点附近收敛效率高一些. 所以一般做能量最小化时都是先利用最速下降法进行优化, 完成之后再对得到的构象利用共轭梯度法优化一次, 这样做能有效地保证后续模拟的进行.

7. __平衡模拟__ 你需要设置适当的模拟参数, 并且保证这些参数的设置与力场的构造过程相一致. 举个简单的例子, GROMOS力场是用范德华势双截断来定义范德华参数的, 如果你用GROMOS力场的话也应该用双截断来处理范德华相互作用. 常见的模拟思路是, 先在NVT下限制住你的溶质(剂)做限制性模拟, 这是一个升温的过程, 当温度达到你设定的温度后, 接着做NPT模拟, 此过程将调整体系的压强进而使体系密度收敛.

	如何判断体系达到平衡是比较技术性的问题. 简单地讲可以通过以下几种方式:

	- 看能量(势能, 动能和总能)是否收敛
	- 看体系的压强, 密度等等是否收敛
	- 看体系的RMSD是否达到你能接受的范围
	- 其他经验

8. __成品模拟__  经过一段时间的平衡模拟, 在确定体系已经完全弛豫之后, 就可以开始采集数据了. 运行足够长时间的模拟以确定我们所感兴趣的现象或是性质能够被观测到, 并且务必确保此现象出现的可重复性.

9. __数据分析__ 数据拿到手后, 很容易通过一些可视化软件得到轨迹动画, 但这并不能拿来发文章. 真正的工作才刚刚开始——分析数据. 你所感兴趣的现象或性质只是表面, 隐含在它们之中的机理才是文章的主题.

## GROMACS入门介绍

### 开始吧

#### 介绍

在本章中, 我们假定读者熟悉分子动力学, 熟悉Unix的基本使用, 包括使用文本编辑器, 如`jot`, `emacs`的`vi`. 我们还假定系统上已正确安装了GROMACS软件. 当你看到这样一行

`ls -l`

你应该在你的计算机上输入行中的内容.

__设置环境__

为了检查你是否能使用GROMACS软件, 请输入以下命令:

`mdrun -version`

该命令应打印出已安装的Gromacs的版本信息. 如果返回的是

	mdrun: command not found.

那么你必须确认GROMACS安装的位置. 默认情况下, GROMACS的应用程序位于'/usr/local/gromacs/bin'.
但是, 你可以咨询机器的系统管理员了解更多信息.
如果假定GROMACS的安装目录为`XXX`, 你会在`XXX/bin`目录中找到可执行文件(程序).
为了能够使用这些程序, 你必须编辑所用shell的登录文件.
如果你使用C shell, 此文件被称为`.cshrc`或`.tcshrc`, 位于你的home目录. 在此文件中添加下面的内容:

	`source XXX/bin/GMXRC`

并在提示符下执行此命令, 或退出并再次登录系统以便自动使设置生效. 现在应该已经设置了环境变量GMXDATA, 我们以后会用到它. 让我们检查是否已经设置成功, 执行:

`echo $GMXDATA`

如果输出了你设置的目录名, 就成功了. 否则的话, 重复上面的步骤.

#### GROMACS文件

下面是你将在教程中遇到的最重要的GROMACS文件类型的简要说明.

- 分子拓扑文件(`.top`)

	分子拓扑文件由`gmx pdb2gmx`程序生成. `gmx pdb2gmx`程序可将任何多肽或蛋白质的pdb结构文件转换为分子拓扑文件. 拓扑文件完整地描述了多肽或蛋白质中的所有相互作用.

- 分子结构文件(`.gro`, `.pdb`)

	当使用`gmx pdb2gmx`程序产生分子拓扑时, 它也会将结构文件(`.pdb`文件)转换为GROMOS结构文件(`.gro`文件).
	pdb文件与gromos文件的主要区别在于格式, 此外`.gro`文件还可以包含速度. 但是, 如果不需要速度, 你可以在所有程序中使用pdb文件. 为在盒子中产生多肽周围的溶剂分子, 可使用`gmx solvate`程序.
	首先应使用`gmx editconf`程序定义分子周围适当大小的盒子. `gmx solvate`将溶质分子(多肽)放入任意溶剂中(在这种情况下, 溶剂是水). `gmx solvate`会输出一个gromos结构文件, 其中的多肽溶解在水中. `gmx solvate`程序也会改变分子拓扑文件(由`gmx pdb2gmx`产生)以添加溶剂到拓扑中.

- 分子动力学参数文件(`.mdp`)

	分子动力学参数(`.mdp`, Molecular Dynamics Parameter)文件包含了与分子动力学模拟本身有关的所有信息, 如时间步长, 积分步数, 温度, 压力等. 得到这种文件的最简单方法是修改示例的`.mdp`文件. 你可以在这里找到一个[示例mdp文件](http://manual.gromacs.org/online/mdp.html).

- 索引文件(`.ndx`)

	有时你可能需要一个索引文件来指定对原子组的作用(如温度耦合, 加速度, 冻结). 通常情况下, 使用默认的索引组就够了, 因此在这个演示中, 我们不考虑使用索引文件.

- 运行输入文件(`.tpr`)

	下一步是将分子结构(`.gro`文件), 拓扑(`.top`文件), MD参数(`.mdp`文件)和(可选的)索引文件(`ndx`)组合起来以生成运行输入文件(扩展名为`.tpr`, 也可以为`.tpb`, 如果你没有XDR的话). 此文件包含了GROMACS启动模拟所需的全部信息. `gmx grompp`程序会处理所有输入文件并生成运行输入`.tpr`文件.

- 轨迹文件(`.trr`)

一旦准备好了运行输入文件, 我们就可以开始进行模拟了. 启动模拟的程序被称为`gmx mdrun`, 它需要的唯一输入文件是运行输入文件(`.tpr`文件). `gmx mdrun`的输出文件是轨迹文件(`.trr`文件, 或`.trj`, 如果你没有XDR的话)和日志文件(`.log`文件).

更多信息请参考下面的使用流程(以快速了解)和GROMACS常见问题.

#### 参考

1. Berendsen, H.J.C., Postma, J.P.M., van Gunsteren, W.F., Hermans, J. (1981)  \n
Intermolecular Forces, chapter Interaction models for water in relation to protein hydration, pp 331-342. Dordrecht: D. Reidel Publishing Company Dordrecht
2. Kabsch, W., Sander, C. (1983). \n
Dictionary of protein secondary structure: Pattern recognition of hydrogen-bonded and geometrical features. Biopolymers 22, 2577--2637.
3. Mierke, D.F., Kessler, H. (1991). \n
Molecular dynamics with dimethyl sulfoxide as a solvent. Conformation of a cyclic hexapeptide. J. Am. Chem. Soc. 113, 9446.
4. Stryer, L. (1988). \n
Biochemistry vol. 1, p. 211. New York: Freeman, 3 edition.

- [原始文档 Getting Started](http://manual.gromacs.org/online/getting_started.html)

----

### 使用流程

使用GROMACS对水盒子中的蛋白质进行分子动力学模拟时, 典型的流程图如下.

更详细的例子可参看上面的<a href="http://manual.gromacs.org/online/getting_started.html">Getting Started</a>.
运行时可能还需要进行一些能量最小化的步骤: grompp -> mdrun.

<center>
<table border="0" cellmargin="0" cellpadding="0" cellspacing="0">

<tbody><tr>
<td colspan="2" align="RIGHT"> <a href="http://manual.gromacs.org/online/pdb.html" onmouseover="window.status=&#39;Protein Databank file&#39;; return true">eiwit.pdb</a></td>
<td align="RIGHT">&nbsp;<img src="/GMX/flow_leftrightdown.gif"></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td colspan="2" align="LEFT">创建GROMACS的拓扑文件</td>
<td></td>
<td bgcolor="#ffffff" colspan="3" align="CENTER">&nbsp;<a href="http://manual.gromacs.org/programs/gmx-pdb2gmx.html" onmouseover="window.status=&#39;Convert PDB file to GROMAX coordinate file and topology&#39;; return true"><b>gmx pdb2gmx</b></a>&nbsp;</td>
<td><img src="/GMX/flow_vrule.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif" border="0"></td>
<td width="20"></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><a href="http://manual.gromacs.org/online/gro.html" onmouseover="window.status=&#39;GROMACS coordinate file containing molecules from PDB file&#39;; return true">conf.gro</a></td>
<td></td>
<td align="CENTER"> <a href="http://manual.gromacs.org/online/top.html" onmouseover="window.status=&#39;GROMACS ascii topology file&#39;; return true">topol.top</a> </td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif" border="0"></td>
<td></td>
<td rowspan="5" colspan="1" align="CENTER"><img src="/GMX/flow_vline.gif"><br><img src="/GMX/flow_vline.gif"><br><img src="/GMX/flow_vline.gif"><br><img src="/GMX/flow_vline.gif"><br><img src="/GMX/flow_down.gif"></td>
</tr>

<tr>
<td colspan="2" align="left">增大盒子</td>
<td></td>
<td align="CENTER" bgcolor="#ffffff">&nbsp;&nbsp;<a href="http://manual.gromacs.org/programs/gmx-editconf.html" onmouseover="window.status=&#39;Adjust boxsize and placement of molecule&#39;; return true"><b>gmx editconf</b></a>&nbsp;&nbsp;</td>
<td></td>
<td><img src="/GMX/flow_vrule.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
<td></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"> <a href="http://manual.gromacs.org/online/gro.html" onmouseover="window.status=&#39;GROMACS coordinate file with adjusted box etc.&#39;; return true">conf.gro</a> </td>
<td></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
<td></td>
</tr>

<tr>
<td colspan="2" align="LEFT">填充水, 蛋白质溶剂化</td>
<td></td>
<td colspan="3" align="CENTER" bgcolor="#ffffff">&nbsp;<a href="http://manual.gromacs.org/programs/gmx-solvate.html" onmouseover="window.status=&#39;Fill box with water (solvate molecule)&#39;; return true"><b>gmx solvate</b></a>&nbsp;</td>
<td><img src="/GMX/flow_vrule.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><a href="http://manual.gromacs.org/online/gro.html" onmouseover="window.status=&#39;GROMACS coordinate file with water molecules added&#39;; return true">conf.gro</a></td>
<td></td>
<td align="CENTER"> <a href="http://manual.gromacs.org/online/top.html" onmouseover="window.status=&#39;GROMACS ascii topology file with water molecules added&#39;; return true">topol.top</a> </td>
</tr>

<tr>
<td colspan="2" align="RIGHT"><a href="http://manual.gromacs.org/online/mdp.html" onmouseover="window.status=&#39;Parameter file for grompp (controls all MD parameters)&#39;; return true">grompp.mdp</a></td>
<td align="RIGHT">&nbsp;<img src="/GMX/flow_leftrightdown.gif"></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
<td></td>
</tr>

<tr>
<td colspan="2" align="LEFT">创建mdrun输入文件</td>
<td></td>
<td colspan="3" align="CENTER" bgcolor="#ffffff">&nbsp; <a href="http://manual.gromacs.org/programs/gmx-grompp.html" onmouseover="window.status=&#39;Process parameters, coordinates and topology and write binary topology&#39;; return true"><b>gmx grompp</b></a> &nbsp;</td>
<td><img src="/GMX/flow_vrule.gif"></td>
<td></td>
<td></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
<td rowspan="3" align="RIGHT">
<img src="/GMX/flow_rightleftdown.gif"></td>
<td align="CENTER" valign="BOTTOM">继续运行</td>
</tr>

<tr>
<td colspan="2" align="LEFT"></td>
<td></td>
<td colspan="3" align="CENTER"> <a href="http://manual.gromacs.org/online/tpr.html" onmouseover="window.status=&#39;Portable GROMACS binary run input file (contains all information to start MD run)&#39;; return true">topol.tpr</a></td>
<td align="CENTER">&nbsp;&nbsp;<a href="http://manual.gromacs.org/online/cpt.html" onmouseover="window.status=&#39;Checkpoint file&#39;; return true">state.cpt</a>&nbsp;&nbsp;</td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
<td rowspan="2" align="CENTER">
<img src="/GMX/flow_vline.gif"><br>
<img src="/GMX/flow_leftup.gif"></td>
</tr>

<tr>
<td colspan="2">运行模拟(EM或MD)</td>
<td></td>
<td colspan="3" align="CENTER" bgcolor="#ffffff">&nbsp;<a href="http://manual.gromacs.org/programs/gmx-mdrun.html" onmouseover="window.status=&#39;The moment you have all been waiting for! START YOUR MD RUN&#39;; return true"><b>gmx mdrun</b></a>&nbsp;</td>
<td></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_vline.gif"></td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"> <a href="http://manual.gromacs.org/online/xtc.html" onmouseover="window.status=&#39;Portable compressed trajectory&#39;; return true">traj.xtc</a> /
<a href="http://manual.gromacs.org/online/trr.html" onmouseover="window.status=&#39;Full precision portable trajectory&#39;; return true">traj.trr</a> </td>
<td></td>
<td align="CENTER"> <a href="http://manual.gromacs.org/online/edr.html" onmouseover="window.status=&#39;Portable energy file&#39;; return true">ener.edr</a> </td>
</tr>

<tr>
<td></td>
<td></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
<td></td>
<td align="CENTER"><img src="/GMX/flow_down.gif"></td>
</tr>

<tr>
<td colspan="2" align="LEFT">分析</td>
<td></td>
<td align="CENTER" bgcolor="#ffffff">&nbsp;&nbsp;<a href="http://manual.gromacs.org/online.html" onmouseover="window.status=&#39;Your favourite GROMACS analysis tool&#39;; return true"><b>g_...</b></a>&nbsp;&nbsp;<br>&nbsp;&nbsp;<a href="http://manual.gromacs.org/programs/gmx-view.html" onmouseover="window.status=&#39;gmx view, the GROMACS trajectory viewer&#39;; return true"><b>gmx view</b></a>&nbsp;&nbsp;</td>
<td></td>
<td align="CENTER" bgcolor="#ffffff">&nbsp;&nbsp;<a href="http://manual.gromacs.org/programs/gmx-energy.html" onmouseover="window.status=&#39;Energy plots, averages and  fluctuations&#39;; return true"><b>gmx energy</b></a>&nbsp;&nbsp;</td>
<td><img src="/GMX/flow_vrule.gif"></td>
</tr>

</tbody></table>
</center>

- [原始文档: Flow Chart](http://manual.gromacs.org/online/flow.html)

### 文件格式

[File Formats](http://manual.gromacs.org/online/files.html)

---

### mdp选项

中文参见手册中的<a href="/GMX/GMXman-7.html#7.3运行参数">运行参数</a>

- [原始文档](http://manual.gromacs.org/online/mdp_opt.html)

---

### 常见问题

[FAQ](http://www.gromacs.org/Documentation/FAQs)

---

## GROMACS实例教程

- 水中的溶菌酶(基于GROMACS 5.0版本)

	- <a href="/GMX/GMXtut-1.#概述">概述</a>
	- <a href="/GMX/GMXtut-1.#第一步:准备拓扑">第一步: 准备拓扑</a>
	- <a href="/GMX/GMXtut-1.#第二步:检查拓扑文件">第二步: 检查拓扑文件</a>
	- <a href="/GMX/GMXtut-1.#第三步:定义单位盒子并填充溶剂">第三步: 定义单位盒子并填充溶剂</a>
	- <a href="/GMX/GMXtut-1.#第四步:添加离子">第四步: 添加离子</a>
	- <a href="/GMX/GMXtut-1.#第五步:能量最小化">第五步: 能量最小化</a>
	- <a href="/GMX/GMXtut-1.#第六步:nvt平衡">第六步: NVT平衡</a>
	- <a href="/GMX/GMXtut-1.#第七步:npt平衡">第七步: NPT平衡</a>
	- <a href="/GMX/GMXtut-1.#第八步:成品md">第八步: 成品MD</a>
	- <a href="/GMX/GMXtut-1.#第九步:分析">第九步: 分析</a>
	- <a href="/GMX/GMXtut-1.#总结">总结</a>

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/lysozyme/index.html)

- KALP15 in DPPC (Updated for 5.0)

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/membrane_protein/index.html)

- Umbrella Sampling

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/umbrella/index.html)

- Biphasic Systems (Updated for 5.0)

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/biphasic/index.html)

- Protein-Ligand Complex (Updated for 5.0)

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/complex/index.html)

- Free Energy Calculations (Updated for 5.0)

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/free_energy/index.html)

- Virtual Sites (Updated for 5.0)

	[原始文档: Justin A. Lemkul](http://www.bevanlab.biochem.vt.edu/Pages/Personal/justin/gmx-tutorials/vsites/index.html)
