---
 layout: post
 title: KineticJS教程4：图形变换与动画
 categories:
 - 科
 tags:
 - 编程
 - js
---

<script src="/jscss/kinetic.min.js"></script>

## 2015-06-11 08:27:22

## 7. 图形变换

## 7.1. 线性变换

`Kinetic`提供了一个图形对象的`transitionTo(config)`方法实现图形的线性变换, 也就是从原始的状态线性变换到新的状态, 这里的状态是指的尺度上的参数. 方法的`config`参数也就是有关图形尺度的一些参数, 比如`x`, `y`, `rotation`, `width`, `height`, `radius`, `strokeWidth`, `alpha`, `scale`, `centerOffset`等. 除了这些尺度参数, 还需要一个`duration`参数, 单位是秒, 也就是指定这种线性变换是在多长时间内变换完成.

比如, 下面代码实现图形在两秒钟内从原位置移动到横坐标100处, 并逐渐变成透明:

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	shape.transitionTo({
		x: 100,
		alpha:0,
		duration:2
	});
&lt;/script&gt;
</code></pre>

## 7.2. 变换中的速度

`Kinetic`的`transitionTo(config)`方法中的`config`参数包括一个`easing`属性, 是指变换是以较均匀的速度到达变换目的点还是在变换过程中在不同位置以不同速度进行变换. `easing`可以设定的值包括`ease-in`, `ease-out`, `ease-in-out`, `back-ease-in`, `back-ease-out`, `back-ease-in-out`, `elastic-ease-in`, `elastic-ease-out`, `elastic-ease-in-out`, `bounce-ease-in`, `bounce-ease-out`, `bounce-ease-in-out`, `strong-ease-in`, `strong-ease-out`以及`strong-ease-in-out`.

在文章里很难形容这些值之间的不同, 还是具体写成代码, 在浏览器里看效果吧.

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	shape.transitionTo({
		x: 100,
		duration: 1,
		easing: "ease-out"
	});
&lt;/script&gt;
</code></pre>

## 7.3. 变换完成后的回调方法

`Kinetic`的`transitionTo(config)`方法中的`config`参数还包括一个回调方法属性, 这个方法会在变换完成后被执行.

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	shape.transitionTo({
		x: 100,
		duration: 1,
		easing: "bounce-ease-out",
		callback: function() {
			alert("transition complete!");
		}
	});
&lt;/script&gt;
</code></pre>

## 7.4. 变换的开始与结束

当执行`transitionTo`方法的时候可以返回一个对象变量, 并用这个对象的`start()`, `stop()`和`resume()`方法来启动, 停止和恢复转换的执行.

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	var trans = shape.transitionTo(config);

	// 开始转换
	trans.start();

	// 停止转换
	trans.stop();

	// 恢复转换
	trans.resume();
&lt;/script&gt;
</code></pre>

## 8. 动画

动画就是一帧帧的画面按照时间间隔显示出来, `Kinetic`给我们提供了一个舞台对象的`onFrame`方法, 用这个方法可以绑定一个动画方法, 我们要显示的动画的每一帧画面就是在这个方法中完成绘制的.

其中, 这个方法接受一个对象`frame`为参数, 此参数对象包含两个属性, 一个是`frame.time`, 表示当前帧是动画开始后的毫秒数, 另一个属性是`frame.timeDiff`, 表示的是当前帧与上一帧之间的时间毫秒差. 当前帧应该是什么形态就是根据这两个参数来判断的. 绘制出当前帧后, 注意要调用一下动画所在的层的`draw`, 将当前帧图像显示到屏幕上.

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	stage.onFrame(function(frame) {
		// update position
		// draw layer
	});
&lt;/script&gt;
</code></pre>

动画的开始与停止是用舞台对象的start与stop方法实现的.

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	var stage = new Kinetic.Stage({
	});

	//动画开始
	stage.start();

	//动画停止
	stage.stop();
&lt;/script&gt;
</code></pre>

如下代码显示了一个左右摆动的圆形

<pre class="line-numbers" data-start="0"><code class="language-javascript"># Language: js
&lt;script&gt;
	window.onload = function() {
		var stage = new Kinetic.Stage({
			container: "container",
			width: 600,
			height: 400
		});

		var layer = new Kinetic.Layer();
		var config = {
			x: 300,
			y: 200,
			radius: 30,
			fill: "red",
			stroke: "black",
			strokeWidth: 5
		};
		var circle = new Kinetic.Circle(config);

		layer.add(circle);
		stage.add(layer);

		var amplitude = 150;
		var period = 2000;
		var centerX = stage.getWidth() / 2;

		//动画帧定义方法
		stage.onFrame(function(frame) {
			circle.setX(amplitude * Math.sin(frame.time * 2 * Math.PI / period) + centerX);
			layer.draw();
		});

		//动画开始
		stage.start();

		//动画停止
		//stage.stop();
	};
&lt;/script&gt;
</code></pre>
