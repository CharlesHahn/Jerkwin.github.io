---
 layout: post
 title: GROMACS中文手册第5章：拓扑文件 1-5节
 categories:
 - 科
 tags:
 - GMX
---

# 第五章　拓扑文件

## 感谢网友崔西翻译前三节

## 5.1 简介

GROMACS运行时需要知道哪些原子及其组合对势能函数有贡献(参见第四章). 此外, 它还需要知道对于不同函数必需的参数. 所有这些都利用 __拓扑文件__ `*.top`进行描述, 它列出了每个原子的 __固定属性__. 原子类型比元素种类多得多, 但力场只对存在于生物系统中的原子类型, 外加一些金属, 离子和硅进行了参数化. 键合相互作用和一些特殊的相互作用由拓扑文件中的固定配对所决定, 必须排除某些非键相互作用(第一和第二近邻), 因为它们已经在键合相互作用中处理过了. 另外, 原子还具有 __动态属性__, 如位置, 速度和力. 严格地说, 这些不属于分子拓扑, 而是存储在坐标文件`*.gro`(位置和速度)或轨迹文件`*.trr`(位置, 速度, 力).

本章将描述拓扑文件, `*.top`文件和数据库文件的设置: 各个参数代表什么, 如果需要如何/到哪里修改它们. 首先, 会解释了所有的文件格式. 然后, 在5.8.1小节说明在每个力场的文件组织形式.

__注意__: 如果你创建了自己的拓扑文件, 我们诚挚地希望你能够将其上传到位于[www.gromacs.org](www.gromacs.org)的拓扑文件存档. 想一想, 如果在开始计算之前, 那里就已经存有你需要的拓扑文件了, 你肯定会感谢那些贡献的人. 如果你创建了新的力场或者对标准力场进行了修改, 我们同样希望你能够将其上传到力场存档.

## 5.2 粒子类型

在GROMACS中, 共有三种类型的粒子, 参见表 5.1. GROMACS只使用了常规原子和虚拟相互作用位点, 壳层只对极化模型, 如壳层水模型, 才是需要的[43].

<table><caption> 表 5.1: GROMACS的粒子类型</caption>
<tr>
<th style="text-align:center;">粒子</th>
<th style="text-align:center;">符号</th>
</tr>
<tr>
<td style="text-align:center;">原子</td>
<td style="text-align:center;">A</td>
</tr>
<tr>
<td style="text-align:center;">壳层</td>
<td style="text-align:center;">S</td>
</tr>
<tr>
<td style="text-align:center;">虚拟相互作用位点</td>
<td style="text-align:center;">V(或D)</td>
</tr>
</table>

### 5.2.1 原子类型

每个力场都定义了一组原子类型, 它们具有特征名称或编号, 质量(以a.m.u为单位). 这些原子类型的列表可以在`atomtypes.atp`(.atp = <strong>a</strong>tom <strong>t</strong>ype <strong>p</strong>arameter, 原子类型参数)文件中找到. 因此, 你可以从这个文件开始修改和/或增加原子类型. 下面的示例原子类型来自于`gromos43a1.ff`力场

	  O 15.99940 ;   carbonyl oxygen (C=O)
	 OM 15.99940 ;   carboxyl oxygen (CO-)
	 OA 15.99940 ;   hydroxyl, sugar or ester oxygen
	 OW 15.99940 ;   water oxygen
	  N 14.00670 ;   peptide nitrogen (N or NH)
	 NT 14.00670 ;   terminal nitrogen (NH2)
	 NL 14.00670 ;   terminal nitrogen (NH3)
	 NR 14.00670 ;   aromatic nitrogen
	 NZ 14.00670 ;   Arg NH (NH2)
	 NE 14.00670 ;   Arg NE (NH)
	  C 12.01100 ;   bare carbon
	CH1 13.01900 ;   aliphatic or sugar CH-group
	CH2 14.02700 ;   aliphatic or sugar CH2-group
	CH3 15.03500 ;   aliphatic CH3-group

__注意__: GROMACS以名称来使用原子类型, 而不是编号(参考GROMOS的例子)

### 5.2.2 虚拟位点

一些力场会使用虚拟相互作用位点(由其他粒子的位置构建的相互作用位点), 并为这些位点设置一些相互作用(例如, 对苯环可产生正确的四极矩), 这些将在4.7中详细介绍.

为了在你的体系中生成虚位点, 你需要在拓扑文件中包含`[ virtual_sites? ]`段(为向后兼容也可以使用老版本中的名称`[ dummmies? ]`), 其中`?`代表构成虚拟位点的粒子数目, 对类型2为`2`, 对类型3, 3fd, 3fad和3out为`3`, 对类型4fdn为`4`. 类型4fdn取代了旧的4fd类型('type'值为1), 因为它有时会不稳定. 尽管程序内部仍然支持4fd类型, 不过最好不要在新的输入文件中使用. 不同类型将在4.7节解释.

类型2的参数看起来应该像这样:

	[ virtual_sites2 ]
	; Site  from    funct    a
	5       1 2     1        0.7439756

类型3的像这样:

	[ virtual_sites3 ]
	; Site  from    funct    a          b
	5       1 2 3   1        0.7439756  0.128012

类型3fd的像这样:

	[ virtual_sites3 ]
	; Site  from    funct   a        d
	5       1 2 3   2       0.5      -0.105

类型3afd的像这样:

	[ virtual_sites3 ]
	; Site  from     funct    theta    d
	5       1 2 3    3        120      0.5

类型3out的像这样:

	; Site  from    funct    a        b        c
	5       1 2 3   4        -0.4     -0.4     6.9281

类型4fdn的像这样:

	[ virtual_sites4 ]
	; Site  from        funct    a        b        c
	5       1 2 3 4     2        1.0      0.9      0.105

这就构成了虚拟位点, 编号5(第一列`Site`)基于其他原子的位置, 这些原子的索引号为1和2, 或者1, 2和3, 或者1, 2, 3和4(接下来的第2, 3或4列`from`), 构建时所遵循的规则由函数类型编号(下一列`func`)以及具体的参数(最后1, 2或3列`a  b ..`)决定`. 显然, 原子数目(包括虚拟位点数)取决于分子. 研究一下GROMCAS自带的TIP4P或TIP5P水模型的拓扑文件对理解这些可能很有帮助.

__注意__, 如果在虚拟位点和/或普通原子之间定义了任何固定的键合相互作用, `grompp`命令将会移除它们(除非使用`-normvsbds`选项). 键合相互作用的移除是在生成排除之后, 因为生成排除是以"化学"的键相互作用为基础.

可以使用更普遍的方法构建虚拟位点, 利用的指令是`[ virtual_sustesn ]`. 所需要的参数列在表5.5中. 下面是将一组给定原子的几何中心定义为虚拟位点的例子:

	[ virtual_sitesn ]
	; Site  funct    from
	5       1        1 2 3 4

<table><caption> 表 5.2: GROMACS中的静态原子类型性质</caption>
<tr>
<th style="text-align:center;">性质</th>
<th style="text-align:center;">符号</th>
<th style="text-align:center;">单位</th>
</tr>
<tr>
<td style="text-align:center;">类型</td>
<td style="text-align:center;">-</td>
<td style="text-align:center;">-</td>
</tr>
<tr>
<td style="text-align:center;">质量</td>
<td style="text-align:center;">m</td>
<td style="text-align:center;">a.m.u</td>
</tr>
<tr>
<td style="text-align:center;">电荷</td>
<td style="text-align:center;">q</td>
<td style="text-align:center;">e</td>
</tr>
<tr>
<td style="text-align:center;">epsilon</td>
<td style="text-align:center;">\(\e\)</td>
<td style="text-align:center;">kJ/mol</td>
</tr>
<tr>
<td style="text-align:center;">sigma</td>
<td style="text-align:center;">\(\s\)</td>
<td style="text-align:center;">nm</td>
</tr>
</table>

## 5.3 参数文件

### 5.3.1 原子

原子类型 __静态性质__ (参见表 5.2)的指定基于几个地方的数据. 质量来源于`atomtypes.apt`文件(参见5.2.1节), 电荷来源于`*.rtp`(.rtp = <strong>r</strong>esidue <strong>t</strong>opology <strong>p</strong>arameter, 残基拓扑参数, 参见5.6.1节)文件. 这就意味着只对构建氨基酸, 核酸的基本单元定义了电荷, 对其他的分子, 用户需要自己定义电荷. 当使用`pdb2gmx`程序生成一个拓扑文件(`*.top`)时, 来自这些文件的信息将被整合在一起.

### 5.3.2 非键参数

非键参数包括van der Waals参数V(`c6`或 $\s$, 由组合规则决定)和W(`c12`或 $\e$), 它们列在`ffnonbonded.itp`文件中, 其中的`ptype`是粒子类型(参见表 5.1). `[ *type ]`指令中的条目和键合参数会被应用它们在拓扑文件中的相应部分. 除了将在5.3.4节中提到的那些, 缺少参数将导致警告.

	[ atomtypes ]
	;name    at.num        mass    charge    ptype          V(c6)         W(c12)
	    O         8    15.99940     0.000        A    0.22617E-02    0.74158E-06
	   OM         8    15.99940     0.000        A    0.22617E-02    0.74158E-06
	   .....

	[ nonbond_params ]
	; i    j    func          V(c6)         W(c12)
	  O    O       1    0.22617E-02    0.74158E-06
	  O   OA       1    0.22617E-02    0.13807E-05
	  .....

__注意__: GROMACS所包含的大部分力场也带有`at.num.`列, 但相同的信息位于OPLS_AA `bond_type`列. 参数V与W的含义取决于拓扑文件`[ defaults ]`段中选择的组合规则(参见5.7.1节).

对组合规则1:

$$\begin{split}
V_{ii} &= C_i^{(6)}  &= 4 \e_i \s_i^6    & \text{[ kJ mol}^{-1} \text{nm}^6 \ \text ] \\
W_{ii} &= C_i^{(12)} &= 4 \e_i \s_i^{12} & \text{[ kJ mol}^{-1} \text{nm}^{12} \ \text ]
\end{split}
\tag{5.1}$$

对组合规则2和3:

$$\begin{split}
V_{ii} &= \s_i    &\text{[ nm ]} \\
W_{ii} &= \e_i    &\text{[ kJ mol}^{-1} \ \text ]
\end{split}
\tag{5.2}$$

对不同原子类型间的一些或所有组合都可以在`[ nonbond_params ]`段给出, 参数V与W的定义同上. 对于其他没有给出的任何原子组合, 将根据组合原则, 利用相应原子类型的参数进行计算.

对组合规则1和3:

$$\alg
C_{ij}^{(6)}  &= \sqrt{C_i^{(6)} C_j^{{6}}} \\
C_{ij}^{(12)} &= \sqrt{C_i^{(12)} C_j^{{12}}}
\ealg
\tag{5.3}$$

对组合规则2:

$$\alg
\s_{ij} &= {1 \over 2}(\s_i+\s_j) \\
\e_{ij} &= \sqrt{\e_i \e_j}
\ealg
\tag{5.4}$$

当需要提供 $\s$ 和 $\e$ 时(规则2和3), 看起来不可能使用非零的 $C^{12}$ 与零值的 $C^6$ 参数进行组合. 然而, 提供负值的 $\s$ 恰好会这样做, $C^6$ 被设为零, $C^{12}$ 正常计算. 这只是代表了读入 $\s$ 值的一种特殊情况, 没有其他的.

对Buckingham势只有一种组合规则:

$$\alg
A_{ij} &= \sqrt{A_{ii} A_{jj}} \\
B_{ij} &= 2/({1 \over B_{ii}}+{1\over B_{jj}}) \\
C_{ij} &= \sqrt{C_{ii} C_{jj}}
\ealg
\tag{5.5}$$

### 5.5.3 键参数

键参数(如, 键长, 键角, 异常/正常二面角)都列在`ffbonded.itp`文件中. 这个数据库中的条目分别给出了相互作用的原子类型, 相互作用的类型, 与相互作用有关的参数. 在处理拓扑文件时, `grompp`程序会读取这些参数, 然后应用到相关的键参数中. 例如将`bondtypes`应用到`[ bonds ]`指令中的条目, 等等. 从相关的`[ *type ]`指令中缺失的任何键参数都会导致致命错误. 相互作用的类型列于表 5.5. 下面是从这些文件中摘录的例子:

	[ bondtypes ]
	; i   j    func         b0         kb
	  C   O       1    0.12300    502080.
	  C  OM       1    0.12500    418400.
	  ......
	  
	[ angletypes ]
	; i    j    k    func        th0        cth
	 HO   OA    C       1    109.500    397.480
	 HO   OA  CH1       1    109.500    397.480
	  ......
	  
	[ dihedraltypes ]
	;  i     l    func       q0         cq
	NR5*   NR5       2    0.000    167.360
	NR5*  NR5*       2    0.000    167.360
	......
	
	[ dihedraltypes ]
	; j    k    func       phi0        cp    mult
	  C   OA       1    180.000    16.736       2
	  C    N       1    180.000    33.472       2
	  ......
	  
	[ dihedraltypes ]
	;
	; Ryckaert-Bellemans Dihedrals
	;
	; aj   ak  funct
	 CP2  CP2      3    9.2789  12.156  -13.120  -3.0597  26.240  -31.495

在`ffbonded.itp`文件中, 你可以添加键参数. 如果你想为新的原子类型增加参数, 请确保你已经在`atometypes.atp`中定义了它们.

### 5.3.4 分子内的对相互作用

分子中原子对之间额外的Lennard-Jones和静电相互作用可以添加到分子定义部分的`[ pairs ]`段中. 这些相互作用的参数可以独立于非键相互作用参数进行设置. 在GROMOS力场中, `[ pairs ]`仅仅用于修改1-4相互作用(相隔3条键的两个原子之间的相互作用). 在这些力场中, 1-4相互作用并不包括在非键相互作用中(参见5.4节).

	[ pairtypes ]
	; i    j  func            cs6           cs12 ; THESE ARE 1-4 INTERACTIONS
	  O    O     1    0.22617E-02    0.74158E-06
	  O   OM     1    0.22617E-02    0.74158E-06
	  .....

`ffnonbonded.itp`文件中原子类型的对相互作用参数位于`[ pairtypes ]`段. GROMOS力场显式地列出了所有这些相互作用的参数, 但对于OPLS这样的力场这一段可能是空的, 因为这些力场通过统一地缩放参数来计算1-4相互作用. 对于那些不在`[ pairtypes ]`段出现的对参数, 只能当`forcefield.itp`文件中`[ defaults ]`指令的`gen-pair`设置为"yes"时才能生成(参见5.7.1节). 当`gen-pairs`设置为"no"时, `grompp`程序会对每个未设定参数的对类型产生警告.

普通对相互作用和1-4相互作用的函数类型为1. 函数类型2和`[ pairs_nb ]`特别用于自由能模拟. 当计算水合自由能时, 需要将溶质与溶剂去耦合. 这可通过添加一个B-状态拓扑(参见3.12节)实现, 其中所有溶质的非键参数, 即电荷和LJ参数, 都被设置为0. 然而, A状态和B状态之间自由能的差值并不是总的水合自由能. 我们必须通过重新引入真空中溶质分子内部的库伦和LJ相互作用来增加自由能. 当溶质内的库伦和LJ相互作用未修改时, 第二步可以与第一步结合起来. 为此, 引入了对函数类型2, 它与函数类型1完全相同, 除了B状态参数与A状态参数始终相同. 

在`[ pairtypes ]`段搜索参数, 函数类型1和2之间并没有什么差别. 对相互作用段`[ pair_nb ]`用于取代非键相互作用. 它使用未缩放的电荷与非键LJ参数, 并只使用A状态的参数. __注意__ 要为`[ pairs_nb ]`中列出的所有原子对添加排除, 否则这些原子对也将在正常的邻区列表中结束.

作为替代, 通过使用`couple-moltype`, `couple-lambda0`, `couple-lambda1`, 和`couple-intramol`关键字, 我们可以不修改拓扑文件而获得同样的行为. 具体请参考3.12节和6.1节.

所有这三种对类型全都使用普通的库伦作用, 即便当使用反应场, PME, Ewald或移位库伦相互作用来计算非键相互作用时. 类型1和2的能量会写入能量和日志文件, 其中每个能量组对都有单独的"LJ-14"和"Coulomb-14"项. `[ paisr_nb ]`的能量会添加到"LJ-(SR)"和"Coulomb-(SR)"项中.

### 5.3.5 隐式溶剂化模型

GROMACS自4.5版本开始支持隐式溶剂. 拓扑文件中引入了一个段用于列出参数:

	[ implicit_genborn_params ]
	; Atomtype    sar      st    pi      gbr       hct
	  NH1         0.155    1     1.028   0.17063   0.79 ; N
	  N           0.155    1     1       0.155     0.79 ; Proline backbone N
	  H           0.1      1     1       0.115     0.85 ; H
	  CT1         0.180    1     1.276   0.190     0.72 ; C

在这个例子中, 先列出了原子类型, 后面有5个数字和注释(分号后面).

目前并未使用1-3列的值. 它们与更精细的表面积算法相关, 特别是Qiu等提出的一个[70]. 第4列为原子的范德华半径, 用于计算波恩半径. 电介质偏移在`*.mdp`文件中指定, 对不同的波恩半径方法会从输入的范德华半径减去此偏移, 如Onufriev等的描述[72]. 第5列是HTC和OBC模型的缩放因子, 数值来源于Tinker程序实现的HTC成对缩放方法[71]. 这种方法被修改过, 缩放因子通过HTC算法被调整得使解析的表面积和GB表面积之间的偏差最小. 根据Hawkins[71]等的建议, 缩放被进一步修改为不是成对的, 而是基于每个原子(而不是每对原子).

## 5.4 排除

`grompp`程序会对相邻直到一定数目键的原子生成非键相互作用的排除, 如在拓扑文件的`[ moleculetype ]`段中定义的那样(参见5.7.1节). 当彼此之间以"化学"键(`[ bonds ]`类型1到5, 7或8)或约束(`[ constraints ]`类型1)连接时, 粒子被认为是键合在一起的. 类型5`[ bonds ]`可用于创建两个原子之间无相互作用的连接. 有一种不通过化学键连接原子的简谐相互作用(`[ bonds ]`类型6), 也有一种不通过化学键连接原子而固定距离的第二类约束类型(`[ constraints ]`类型2). 所有这些相互作用的完整列表见表 5.5.

分子内额外的排除可以手动在`[ exclusions ]`段中添加. 每行必须以一个原子编号开始, 后面跟着一个或多个原子编号. 第一个原子和其他原子之间的所有非键相互作用都会被排除.

当需要排除原子组内部或彼此之间的非键相互作用时, 使用能量监测组排除会更方便和高效(参见3.3节).

## 5.5 约束算法

约束的定义在`[ constraints ]`段中, 其格式为两个原子编号, 后面跟着函数类型和约束距离. 函数类型可以为1或2, 它们之间的唯一区别在于, 类型1用于产生排除而类型2不产生排除(参见5.4节). 距离是通过在`*.mdp`文件中选择的LINCS或SHAKE算法进行约束的. 在自由能计算中, 通过增加第二个约束距离, 这两种类型的约束都可以进行微扰(参见5.7.5节). `grompp`程序可自动将一些类型的键或键角(参见表 5.5)转变为约束, 在`*.mdp`文件中有很多相关的选项.

我们也实现了SETTLE算法[45], 它对SHAKE进行解析求解, 只用于水. 可以在拓扑文件中选择SETTLE. 例如, 请参看SPC水分子的定义:

	[ moleculetype ]
	; molname    nrexcl
	  SOL        1
	  
	[ atoms ]
	; nr    at type    res nr    ren nm    at nm    cg nr    charge
	  1     OW         1         SOL       OW1      1        -0.82
	  2     HW         1         SOL       HW2      1         0.41
	  3     HW         1         SOL       HW3      1         0.41
	  
	[ settles ]
	; OW    funct    doh    dhh
	  1     1        0.1    0.16333
	  
	[ exclusions ]
	1    2    3
	2    1    3
	3    1    2

`[ settles ]`指令定义了水分子的第一个原子, SETTLE函数类型始终为1, 必须给出O-H和H-H之间的距离. __注意__, SETTLE算法也可用于TIP3P和TIP4P水分子模型[125]. TIP3P具有另一个构型, TIP4P具有一个虚拟位点, 但由于是生成的, 不需要抖动(或扰动).
