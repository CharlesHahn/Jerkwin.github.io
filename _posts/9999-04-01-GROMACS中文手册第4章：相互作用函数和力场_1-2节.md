---
 layout: post
 title:  GROMACS中文手册第4章：相互作用函数和力场 1-2节
 categories:
 - 科
 tags:
 - GMX
---

# 第四章　相互作用函数和力场

## 感谢网友阮洋帮忙录入公式

为了能够使用一些流行力场中采用的势能函数(见4.10节)，GROMACS提供了一些势能函数，包括非键相互作用以及二面角的相互作用。我们将在适当的小节中对它们予以讨论。

势能函数可以被划分成三个部分：

1. __非键项__: Lennard-Jones或Buckingham，以及库仑或修正的库仑。非键相互作用的计算基于已移除了排除项的邻区列表(一定半径内非键原子的列表)。

2. __键合项__: 共价键伸缩，键角弯曲，反常二面角，和正常二面角。这些项的计算是基于固定的列表。

3. __约束项__: 位置约束，角度约束，距离约束，方向约束和二面角约束，均基于固定的列表进行计算。

## 4.1 非键相互作用

GROMACS的非键相互作用是对势累加的(pair-additive)，并满足中心对称：

$$V(\bi r_1, \cdots \bi r_N) = \sum_{i< j} V_{ij}(\bi r_{ij}) \tag{4.1}$$

$$\bi F_i = - \sum_j {dV_{ij}(r_{ij}) \over dr_{ij}} {\bi r_{ij} \over r_{ij}} = - \bi F_j \tag{4.2}$$

非键相互作用包含排斥项，色散项和库仑项。组合起来的排斥项和色散项可以取Lennard-Jones(或6-12相互作用)或Buckingham(或exp-6势)形式。此外，(部分)带电的原子之间的非键相互作用通过库仑项表达。

<figure>
<img src="/GMX/4.1.png" alt="图4.1：Lennard-Jones相互作用" />
<figcaption>图4.1：Lennard-Jones相互作用</figcaption>
</figure>

### 4.1.1 Lennard-Jones相互作用

两个原子之间Lennard-Jones势 $$V_{LJ}(r_{ij})$$ 等于：

$$V_{LJ}(r_{ij}) = {C_{ij}^{(12)} \over r_{ij}^{12} } - {C_{ij}^{(6)} \over r_{ij}^6} \tag{4.3}$$

其函数曲线如图4.1所示。参数 $$C_{ij}^{(12)}$$ 和 $$C_{ij}^{(6)}$$ 取决于配对的 __原子类型__; 因此来源于LJ-参数矩阵。在Verlet截断方案中，通过将势能移动一个恒量，可使其在截断距离处为零。

此势能函数的力是：

$$\bi F_i(\bi r_{ij}) = \left(12{C_{ij}^{(12)} \over r_{ij}^{13}} - 6{C_{ij}^{(6)} \over r_{ij}^7}\right){\bi r_{ij} \over r_{ij}} \tag{4.4}$$

LJ势也可以写成以下形式：

$$V_{LJ}(r_{ij}) = 4 \varepsilon_{ij} \left( \left({\sigma_{ij} \over r_{ij}} \right)^{12} - \left({\sigma_{ij} \over r_{ij}}\right)^6 \right) \tag{4.5}$$

在构造非键LJ-参数的参数矩阵时，GROMACS可使用两种不同的组合规则，只采用几何平均值（力场文件输入部分的类型1）：

$$\begin{split}
C_{ij}^{(6)} &= \left( C_{ii}^{(6)} C_{jj}^{(6)} \right)^{1/2} \\
C_{ij}^{(12)} &= \left(C_{ii}^{(12)} C_{jj}^{(12)} \right)^{1/2}
\end{split} \tag{4.6}$$

或采用Lorentz-Berthelot规则。此规则利用算术平均计算 $$\s_{ij}$$, 利用几何平均计算 $$\ve_{ij}$$ （类型2）：

$$\begin{split}
\sigma_{ij} &= {1 \over 2}(\sigma_{ii} + \sigma_{jj}) \\
\varepsilon_{ij} &= (\varepsilon_{ii} \varepsilon_{jj})^{1/2}
\end{split} \tag{4.7}$$

最后，可以对两个参数都采用几何平均值（类型3）：

$$\begin{split}
\sigma_{ij} = (\sigma_{ii} \sigma_{jj})^{1/2} \\
\varepsilon_{ij} = (\varepsilon_{ii} \varepsilon_{jj})^{1/2}
\end{split} \tag{4.8}$$

OPLS力场就采用这个规则。

<figure>
<img src="/GMX/4.2.png" alt="图4.2：Buckingham相互作用" />
<figcaption>图4.2：Buckingham相互作用</figcaption>
</figure>

### 4.1.2 Buckingham势

与Lennard-Jones势相比，Buckingham势的排斥项更加灵活，贴近实际，但其计算也更昂贵。Buckingham势的形式是：

$$V_{bh}(r_{ij}) = A_{ij} \exp(-B_{ij} r_{ij}) - {C_{ij} \over r_{ij}^6} \tag{4.9}$$

请参见图4.2。此势能函数的力为：

$$\bi F_i(r_{ij}) = \left[ A_{ij} B_{ij} \exp(-B_{ij} r_{ij}) - 6{C_{ij} \over r_{ij}^7} \right] {\bi r_{ij} \over r_{ij}} \tag{4.10}$$

### 4.1.3 库仑相互作用

两个带电粒子之间的库仑相互作用由下式给出：

$$V_c(r_{ij}) = f{q_i q_j \over \varepsilon_r r_{ij}} \tag{4.11}$$

参见图4.3，其中 $f={1 \over 4\p\ve_0}=138.935 485$ （见第2章）

此势对应的力为：

$$\bi F_i(r_{ij}) = f{q_i q_j \over \varepsilon_r r_{ij}^2} {\bi r_{ij} \over r_{ij}} \tag{4.12}$$

<figure>
<img src="/GMX/4.3.png" alt="图4.3：反应场与非反应场的库仑相互作用（带同种电荷的粒子之间）。在非反应场的情况下 $\ve_r$ 为1， $\ve_{rf}$ 为78， $r_c$ 为0.9纳米。除相差一个常数外，点划线与虚线完全相同。" />
<figcaption>图4.3：反应场与非反应场的库仑相互作用（带同种电荷的粒子之间）。在非反应场的情况下 <span class="math">\(\ve_r\)</span> 为1， <span class="math">\(\ve_{rf}\)</span> 为78， <span class="math">\(r_c\)</span> 为0.9纳米。除相差一个常数外，点划线与虚线完全相同。</figcaption>
</figure>

使用普通的库仑相互作用时要么不能截断，要么所有粒子对都处于截断半径范围内，因为力在截断处存在跃变，而且变化很大。如果你确实需要使用截断，可以将势能进行移动以使势能等于力的积分。在基于组的截断方案中，这种移动只适用于非排除对。在Verlet截断方案中，移动也适用于排除对和自相互作用，这使得势能等同于 $\ve_{rf}=1$ 的反应场（见下文）。

GROMACS中相对介电常数 $\ve_r$ 可在`grompp`的输入中设置。

### 4.1.4 反应场库仑作用

对均相体系，可通过假定截断半径 $r_c$ 以外的粒子周围是介电常数为 $\ve_{rf}$ 的恒定介电环境，对库仑相互作用进行校正。此时，库仑相互作用可写为：

$$V_{crf} = f{q_i q_j \over \varepsilon_r r_{ij}} \left[ 1 + {\varepsilon_{rf} - \varepsilon_r \over 2 \varepsilon_{rf} + \varepsilon_r } {r_{ij}^3 \over r_c^3} \right] - f {q_i q_j \over \varepsilon_r r_c} {3 \varepsilon_{rf} \over 2 \varepsilon_{rf} + \varepsilon_r} \tag{4.13}$$

上式右边的常量表达式使得在截断处势能为零。对带电的截断球体，上式对应于均匀背景电荷的中性化。我们可以将方程4.13简写为

$$V_{crf} = f{q_i q_j \over \varepsilon_r} \left[ {1 \over r_{ij}} + k_{rf} r_{ij}^2 - c_{rf}\right] \tag{4.14}$$

其中,

$$\alg
k_{rf} &= {1 \over r_c^3} {\varepsilon_{rf} - \varepsilon_r \over (2 \varepsilon_{rf} + \varepsilon_r)} \tag{4.15} \\
c_{rf} &= {1 \over r_c} + k_{rf} r_c^2 = {1 \over r_c} {3\varepsilon_{rf} \over (2 \varepsilon_{rf} + \varepsilon_r)} \tag{4.16}
\ealg$$

对大的 $$\ve_{rf}$$, $$k_{rf}$$ 趋近 $$r_c^{-3}/2$$, 而当 $$\ve_{rf}=\ve_r$$ 时校正消失。图4.3中画出了校正的相互作用，很显然，对 $$r_{ij}$$ 的导数(即负的力)在截断距离处为零。这种势函数对应的力为：

$$\bi F_i(\bi r_{ij}) = f{q_i q_j \over \varepsilon_r} \left[ {1 \over r_{ij}^2} - 2 k_{rf} r_{ij} \right]{\bi r_{ij} \over r_{ij}} \tag{4.17}$$

反应场校正也可以用于所有的排除原子对，包括自身对，在这种情况下，方程4.13和4.17中不出现正常的库仑项。

Tironi等引入了更一般的反应场理论，其截断半径 $r_c$ 以外的电介质也具有离子强度 $I$[75]。这种情况下，我们可以利用逆Debye屏蔽长度 $\kappa$, 将常数 $$k_{rf}$$ 和 $$c_{rf}$$ 重写为

$$\alg
\kappa^2 &= {2IF^2 \over \varepsilon_0 \varepsilon_{rf}RT} = {F^2 \over \varepsilon_0 \varepsilon_{rf}RT} \sum_{i=1}^K c_i z_i^2 \tag{4.18} \\
k_{rf} &= {1 \over r_c^3} { (\varepsilon_{rf}-\varepsilon_r)(1+\kappa r_c) + {1 \over 2}\varepsilon_{rf}(\kappa r_c)^2 \over (2\varepsilon_{rf}+\varepsilon_r)(1+\kappa r_c) + \varepsilon_{rf}(\kappa r_c)^2} \tag{4.19} \\
c_{rf} &= {1 \over r_c} {3 \varepsilon_{rf} (1+\kappa r_c + {1\over2}(\kappa r_c)^2) \over (2 \varepsilon_{rf} + \varepsilon_r)(1+\kappa r_c) + \varepsilon_{rf}(\kappa r_c)^2} \tag{4.20}
\ealg$$

其中, $F$ 是法拉第常数, $R$ 是理想气体常数, $T$ 是绝对温度, $c_i$ 是物种 $i$ 的摩尔浓度, $z_i$ 是物种 $i$ 的电荷数，共有 $K$ 种不同的物种。在离子强度为零的极限情况下，方程4.19和4.20分别退化为简单形式的方程4.15和4.16。

### 4.1.5 修正的非键相互作用

在GROMACS中，可以利用移位函数对非键势能函数进行修改，其目的在于用连续的力取代截断的力，且使其在截断半径处具有连续的导数。使用这种力时，每步积分引入的误差更小，且避免了一些复杂情况，比如在截断过程中由偶极产生的电荷。实际上，使用移位力时，不需要对电荷组创建邻近列表。然而，移位函数使库仑势产生了一个相当大的变形。除非对“丢失”的远程势进行了正确的计算以及加和（通过使用PPPM，Ewald或PME），否则必须仔细评估这些修改的效果。对Lennard-Jones色散项和排斥项的修改较小，但它确实消除了截断效应引起的噪声。

切换函数（将势能乘上一个函数）和移位函数（将势能或力加上一个函数）之间 __没有__ 本质区别[76]。切换函数是移位函数的一种特殊情况。将切换函数应用于与粒子 $j$ 作用在粒子 $i$ 上的静电力或范德华力有关的 __力函数 $F(r)$__ ：

$$\bi F_i = cF(r_{ij}){\bi r_{ij} \over r_{ij}} \tag{4.21}$$

对于纯的库仑或Lennard-Jones相互作用, $F(r)= F_\a(r)= r^{-\a+1}$. 移位力 $F_s(r)$ 一般可写为：

$$\alg
F_s(r) &= F_\a (r)        & &r < r_1 \\
F_s(r) &= F_\a (r) + S(r) & &r_1 \le r \le r_c \tag{4.22} \\
F_s(r) &= 0               & &r_c \le r
\ealg$$

当 $r_1$ =0 时，这是一个通常的移动函数，否则它就是一个切换函数。相应的移位库仑势为：

$$V_s(r_{ij}) = f \F_s(r_{ij}) q_i q_j  \tag{4.23}$$

其中, $\F(r)$ 是势函数

$$\F_s(r) = \int_r^\infty  F_s(x)dx \tag{4.24}$$

GROMACS的移位函数在边界处应该是平滑的，因此移位函数应当满足以下边界条件：

$$\alg
\begin{split}
S(r_1) &= 0 \\
S'(r_1) &= 0 \\
S(r_c) &=  - F_\a (r_c) \\
S'(r_c) &=  - F_\a'(r_c) 
\end{split} \tag{4.25}
\ealg$$

三阶多项式形式

$$S(r) = A(r - r_1)^2 + B(r - r_1)^3 \tag{4.26}$$

即满足这些要求。常数 $A$ 和 $B$ 可利用 $r_c$ 处的边界条件求出

$$\alg
\begin{split}
A &=  - {(\a + 4)r_c - (\a + 1)r_1 \over r_c^{\a+2}(r_c - r_1)^2} \\
B &= {(\a+3)r_c - (\a+1)r_1 \over r_c^{\a+2} (r_c-r_1)^3}
\end{split}\tag{4.27}
\ealg$$

因此，整个力函数为：

$$F_s(r) = {\a \over r^{\a+1}} + A(r-r_1)^2 + B(r-r_1)^3 \tag{4.28}$$

相应的势函数为：

$$\F(r) = {1 \over r^\a} - {A \over 3}(r - r_1)^3 - {B \over 4}(r - r_1)^4 - C \tag{4.29}$$

其中

$$C = {1 \over r_c^\a } - {A \over 3}(r_c - r_1)^3 - {B \over 4}(r_c - r_1)^4 \tag{4.30}$$

<figure>
<img src="/GMX/4.4.png" alt="图4.4：库仑力，移位力与移位函数 $S(r)$, 其中 $r_1=2, r_c=4$. " />
<figcaption>图4.4：库仑力，移位力与移位函数 <span class="math">\(S(r)\)</span>, 其中 <span class="math">\(r_1=2, r_c=4\)</span>. </figcaption>
</figure>

当 $r_1$ =0 时，修正的库仑力函数

$$F_s(r) = {1 \over r^2} - {5 r^2 \over r_c^4} + {4 r^3 \over r_c^5} \tag{4.31}$$

与推荐使用的短程函数加上长程部分的泊松解是相同的[77]。修正的库仑势函数为：

$$\F(r) = {1 \over r} - {5 \over 3r_c} + {5r^3 \over 3r_c^4} - {r^4 \over r_c^5} \tag{4.32}$$

参见图 4.4。

### 4.1.6 修改的Ewald求和短程相互作用

当利用Ewald求和方法或粒子网格Ewald方法计算长程相互作用时，短程库仑势必须进行修改，这与上面切换函数的情形类似。在这种情况下，短程势能由下式给出：

$$V(r) = f{\text{erfc}(\beta r_{ij}) \over r_{ij}} q_i q_j \tag{4.33}$$

其中, $\b$ 参数用于决定直接空间和与倒易空间和之间的相对比重, $\text{erfc}(x)$ 是余误差函数。关于长程静电相互作用的详细讨论见4.8节。

<figure>
<img src="/GMX/4.5.png" alt="图4.5：键伸缩的原理（左）以及键伸缩的势能（右）。" />
<figcaption>图4.5：键伸缩的原理（左）以及键伸缩的势能（右）。</figcaption>
</figure>

## 4.2 键合相互作用

键合相互作用基于固定的原子列表。它们不仅包括对相互作用(pair interactions)，也包括三体和四体相互作用。键合相互作用包括 __键伸缩__(双体)， __键角__(三体)和 __二面角__(四体)相互作用。一种特殊类型的二面角相互作用(称为 __异常二面角__)可用于将原子保持在同一平面上，或是避免将分子转变为相反手性（镜像）的结构。

### 4.2.1 键伸缩

__简谐势__

两个共价键合原子 $i$ 和 $j$ 之间的键伸缩可利用简谐势进行描述

$$V_b(r_{ij}) = {1 \over 2}k_{ij}^b (r_{ij} - b_{ij})^2 \tag{4.34}$$

参见图4.5，相应的力如下：

$$\bi F_i(\bi r_{ij}) = k_{ij}^b(r_{ij} - b_{ij}) {\bi r_{ij} \over r_{ij}} \tag{4.35}$$

__四次幂势__

在GROMOS-96力场[78]中，为提高计算效率，共价键势记为以下形式：

$$V_b(r_{ij}) = {1 \over 4}k_{ij}^b \left( r_{ij}^2 - b_{ij}^2 \right)^2  \tag{4.36}$$

相应的力为：

$$\bi F_i(\bi r_{ij}) = k_{ij}^b(r_{ij}^2 - b_{ij}^2) \bi r_{ij} \tag{4.37}$$

对这种形式的势函数，其力常数与通常的简谐力常数 $k^{b,\text{harm}}$ (4.2.1节) 存在如下关系

$$2k^b b_{ij}^2 = k^{b,\text{harm}} \tag{4.38}$$

力常数大多是由GROMOS-87使用的简谐力常数导出[79]。尽管计算时这种形式效率更高（因为不需要计算平方根），但它在概念上比较复杂。它还存在一个特别的缺点，由于不是简谐势形式，单个键的平均能量不等于 ${1\over2}kT$ ，而在正常的简谐势情况下是 ${1\over2}kT$.

### 4.2.2 Morse势键伸缩

对需要非简谐键伸缩势的一些体系，GROMACS提供了两个原子 $i$ 和 $j$ 之间的Morse势[80]。这个势能函数与简谐势的不同在于，它具有一个不对称的势阱，且无限远处的力为零。函数形式是：

$$V_{morse}(r_{ij}) = D_{ij} [1 - \exp(-\beta_{ij} (r_{ij}-b_{ij}))]^2 \tag{4.39}$$

参见图4.6，相应的力是：

$$\bi F_{morse}(\bi r_{ij}) = 2 D_{ij} \beta_{ij} r_{ij} \exp(-\beta_{ij}(r_{ij}-b_{ij}))* \\
    [1 - \exp(-\beta_{ij} (r_{ij}-b_{ij}))] {\bi r_{ij} \over r_{ij}} \tag{4.40}$$

其中 $$D_{ij}$$ 是势阱深度，以 $$\text{kJ/mol}$$ 为单位， $$\beta_{ij}$$ 定义了势阱的陡度（以 $$\text{nm^{-1}}$$ 为单位）， $$b_{ij}$$ 为平衡距离(以 $$\text{nm}$$ 为单位)。陡度参数 $$\beta_{ij}$$ 可用原子 $i$ 和 $j$ 的约化质量、基本振动频率 $$\mu_{ij}$$ 和势阱深度 $$D_{ij}$$ 表示：

$$\beta_{ij} = \omega_{ij} \sqrt{\mu_{ij} \over 2 D_{ij} } \tag{4.41}$$

且因为 $\omega = \sqrt{k \over \mu}$ ，可将 $$\beta_{ij}$$ 改用简谐力常数 $$k_{ij}$$ 表示：

$$\beta_{ij} = \sqrt{k_{ij} \over 2 D_{ij}} \tag{4.42}$$

对于小的偏差 $$(r_{ij} - b_{ij})$$ ，可利用泰勒展开，取指数项的一阶近似：

$$\exp(-x) \approx 1 - x \tag{4.43}$$

将方程 4.42和4.43代入到函数中：

$$\alg
V_{morse}(r_{ij}) &= D_{ij} [1 - \exp(-\beta_{ij} (r_{ij}-b_{ij}))]^2 \\
&  = D_{ij} [1 - (1 - \sqrt{k_{ij} \over 2 D_{ij}} (r_{ij}-b_{ij}))]^2 \\
&  = {1 \over 2} k_{ij} (r_{ij} - b_{ij})^2 \tag{4.44}
\ealg$$

就得到了简谐键伸缩势。

<figure>
<img src="/GMX/4.6.png" alt="图4.6：Morse势阱，键长为0.15nm。" />
<figcaption>图4.6：Morse势阱，键长为0.15nm。</figcaption>
</figure>

### 4.2.3 立方键伸缩势

另一种比Morse势稍简单的非简谐键伸缩势是在简单的简谐形式上增加了距离的一个立方项：

$$V_b(r_{ij}) = k_{ij}^b (r_{ij}-b_{ij})^2 + k_{ij}^b k_{ij}^{cub} (r_{ij}-b_{ij})^3 \tag{4.45}$$

在Ferguson[82]发展的一个柔性水模型（基于SPC水模型[81]）中，OH键使用了立方键伸缩势。该模型给出了合理的红外光谱。GROMACS库中提供了Ferguson水模型(`flexwat-ferguson.itp`)。应当指出，这种势函数是不对称的：过分拉伸导致能量无限降低。因此积分的时间步长被限制为1 fs。

该势对应的力为：

$$\bi F_i(r_{ij}) = 2k_{ij}^b (r_{ij}-b_{ij}) {\bi r_{ij} \over r_{ij}} + 3k_{ij}^b k_{ij}^{cub} (r_{ij}-b_{ij})^2 {\bi r_{ij} \over r_{ij}} \tag{4.46}$$


### 4.2.4 FENE键伸缩势

在聚合物的粗粒化模拟中，珠子之间通常由FENE(finitely extensible nonlinear elastic, 有限扩展非线弹性)势[83]连接：

$$V_{\text{FENE}}(r_{ij}) = - {1 \over 2} k_{ij}^b b_{ij}^2 \log\left( 1 - {r_{ij}^2 \over b_{ij}^2} \right) \tag{4.47}$$

这种势能函数看起来很复杂，但力的表达式更简单：

$$\bi F_{\text{FENE}}(r_{ij}) = - k_{ij}^b \left( 1 - {r_{ij}^2 \over b_{ij}^2} \right)^{-1} \bi r_{ij} \tag{4.48}$$

在短距离处此势不对称地接近力常数为 $k^b$ 的简谐势，而在距离为 $b$ 时发散。

<figure>
<img src="/GMX/4.7.png" alt="图4.7：角振动原理（左）和键角势（右）。" />
<figcaption>图4.7：角振动原理（左）和键角势（右）。</figcaption>
</figure>

### 4.2.5 简谐角势

三个原子 $i-j-k$ 之间的键角振动也可以用键角 $\theta_{ijk}$ 的简谐势描述

$$V_a (\theta_{ijk}) = {1 \over 2} k_{ijk}^\theta (\theta_{ijk} - \theta_{ijk}^0)^2 \tag{4.49}$$

由于键角的振动由简谐势描述，其形式与键伸缩是一样的（图4.5）。

利用链式规则，可得到力的方程：

$$\alg
\bi F_i &= - {d V_a(\theta_{ijk}) \over d \bi r_i}  \\
\bi F_k &= - {d V_a(\theta_{ijk}) \over d \bi r_k} \quad 其中  \theta_{ijk} = \arccos{ (\bi r_{ij} \cdot \bi r_{kj}) \over r_{ij} r_{kj} } \tag{4.50} \\
\bi F_j &=  - \bi F_i - \bi F_k
\ealg$$

编号 $i, j, k$ 是共价键原子的序列。原子 $j$ 处于中间；原子 $i$ 和 $k$ 处于顶端（见图4.7）。注意，在拓扑文件的输入中，键角以度为单位，力常数以 $\text{kJ/mol/{rad}}^2$ 为单位。

### 4.2.6 余弦键角势

GROMOS-96力场利用一个简化的函数表示角振动：

$$V_a(\theta_{ijk}) = {1 \over 2} k_{ijk}^\theta \left( \cos(\theta_{ijk}) - \cos(\theta_{ijk}^0) \right)^2 \tag{4.51}$$

其中

$$\cos(\theta_{ijk}) = {\bi r_{ij} \cdot \bi r_{kj} \over r_{ij} r_{kj} } \tag{4.52}$$

相应的力可通过对原子位置的偏微分推导出来。这个函数中的力常数与简谐势的力常数 $k^{\theta,\text{harm}}$ (4.2.5) 存在如下关系

$$k^\theta \sin^2(\theta_{ijk}^0) = k^{\theta,\text{harm}} \tag{4.53}$$

<figure>
<img src="/GMX/4.8.png" alt="图4.8：弯曲键角势：余弦简谐（黑实线），简谐角（虚黑线）和限制弯曲（红色），三者具有相同的弯曲常数 $k_{\theta} = 85 \text{kJ mol}^{-1}$ 和平衡角 $\theta_0 = 130^{\circ}$ 。橙色线表示余弦简谐($k = 50 \text{kJ mol}^{-1}$)与限制弯曲($k = 25 \text{kJ mol}^{-1}$)的和，二者的 $\theta_0 = 130^{\circ}$ 。" />
<figcaption>图4.8：弯曲键角势：余弦简谐（黑实线），简谐角（虚黑线）和限制弯曲（红色），三者具有相同的弯曲常数 <span class="math">\(k_{\theta} = 85 \text{kJ mol}^{-1}\)</span> 和平衡角 <span class="math">\(\theta_0 = 130^{\circ}\)</span> 。橙色线表示余弦简谐(<span class="math">\(k = 50 \text{kJ mol}^{-1}\)</span>)与限制弯曲(<span class="math">\(k = 25 \text{kJ mol}^{-1}\)</span>)的和，二者的 <span class="math">\(\theta_0 = 130^{\circ}\)</span> 。</figcaption>
</figure>

在GROMOS-96手册中有一个更加复杂的，与温度相关的转换公式。这些公式在0 K时是等效的，300 K时的差异大约为0.1%到0.2%。 __注意__ 在拓扑文件的输入中，角度的单位为度，力常数的单位为kJ/mol。

### 4.2.7 受限弯曲势

受限弯曲（ReB）势[84]可防止弯曲角度 $\theta$ 达到 $180^{\circ}$ 。这样，在进行粗粒分子动力学模拟时，避免了计算扭转角和势能带来的数值不稳定性。

为了系统地防止弯曲角度达到 $180^{\circ}$ ，在弯曲势4.51的分母项中引入了 $\sin^2\theta$ 因子

$$V_{\text{ReB}}(\theta_i)={1 \over 2} k_\theta {(\cos\theta_i-\cos\theta_0)^2 \over \sin^2\theta_i} \tag{4.54}$$

图4.8显示了ReB势4.54和标准势4.51之间的比较。ReB势的壁垒在靠近 $180^{\circ}$ 的区域非常排斥，因此，弯曲角能够保持在一定的安全区间内，远离不稳定性。之所以在分母中使用 $\sin\theta$ 的二次方项是为了保证这种行为，并且能给出优雅的微分表达式：

$$F_{\text{ReB}}(\theta_i) = {2 k_\theta \over \sin^4\theta_i}(\cos\theta_i-\cos\theta_0)(1-\cos\theta_i \cos\theta_0){\partial \cos\theta_i \over \partial \vec r_k} \tag{4.55}$$

因其构造，限制弯曲势不能用于平衡的 $\theta_0$ 值太接近 $0^{\circ}$ 或 $180^{\circ}$ 的情形（根据经验，推荐至少有 $10^{\circ}$ 的差异）。重要的是，在初始构型中，所有的弯曲角度都必须处在安全的区间内，以避免初始的不稳定性。这种弯曲势可以与任何形式的扭转势联合使用。使用它将总是能够避免三个连续的粒子变成共线结构，因此，任何扭转势都不会出现奇点。也可以将它加入到标准的弯曲势中，以处理约 $180^{\circ}$ 的角，但在极小点附近保持它的原始形式（参见图4.8中的橙色曲线）。

### 4.2.8 Urey-Bradley势

三个原子 $i - j - k$ 之间的Urey-Bradley键角振动用角 $\theta_{ijk}$ 的简谐势和原子 $i$ 和 $k$ 之间的距离的简谐校正项来描述。尽管可以很容易地将它写成两项的简单加和，但方便的做法是把它作为拓扑文件中的单独一项，并在在输出文件中作为单独的能量项。这种势能主要用在CHARMM力场[85]中。其能量由下式给出：

$$V_a(\theta_{ijk})={1\over2}k_{ijk}^\theta(\theta_{ijk}-\theta_{ijk}^0)^2 + {1\over2}k_{ijk}^{UB}(r_{ik}-r_{ik}^0)^2 \tag{4.56}$$

力的方程可从4.2.1和4.2.5节推导出来.

### 4.2.9 键键交叉项

形成键 $i - j$ 和 $k - j$ 的三个粒子 $i,j,k$ 之间的键键交叉项由下式给出[86]：

$$V_{rr'}=k_{rr'}(\abs{\bi r_i-\bi r_j}-r_{1e})(\abs{\bi r_k-\bi r_j}-r_{2e}) \tag{4.57}$$

其中 $k_{rr'}$ 是力常数， $r_{1e}$ 和 $r_{2e}$ 分别是键 $i - j$ 和 $j - k$ 的平衡键长。此势对应的粒子 $i$ 受到的力是：

$$\bi F_i=-k_{rr'}(\abs{\bi r_k-\bi r_j}-r_{2e}){\bi r_i-\bi r_j \over \abs{\bi r_i-\bi r_j}} \tag{4.58}$$

原子 $k$ 受到的力可以通过交换上述方程中 $i$ 和 $k$ 得到。最后，原子 $j$ 受到的力遵循内力之和应该为零的事实： $\bi F_j = - \bi F_i - \bi F_k$ 。

### 4.2.10 键-角交叉项

为形成键 $i - j$ 和 $k - j$ 的三个粒子 $i,j,k$ 之间的键-角交叉项由下式给出[86]：

$$V_{k\theta}=k_{r\theta}(\abs{\bi r_i-\bi r_k}-r_{3e})(\abs{\bi r_i-\bi r_j}-r_{1e}+\abs{\bi r_k-\bi r_j}-r_{2e}) \tag{4.59}$$

其中 $k_{r\theta}$ 为力常数， $r_{3e}$ 为 $i - k$ 之间的距离，其他常数的含义与方程4.57中相同。原子 $i$ 受到的力为：

$$\bi F_i = -k_{r\theta}\left[ (\abs{\bi r_i-\bi r_k}-r_{3e}){\bi r_i-\bi r_j \over \abs{\bi r_i-\bi r_j}}+(\abs{\bi r_i-\bi r_j}-r_{1e}+\abs{\bi r_k-\bi r_j}-r_{2e}) {\bi r_i-\bi r_k \over \abs{\bi r_i-\bi r_k}} \right]  \tag{4.60}$$

### 4.2.11 四次键角势

键角势可以使用四阶多项式以满足特殊目的

$$V_q(\theta_{ijk})=\sum_{n=0}^5 C_n(\theta_{ijk}-\theta_{ijk}^0)^n \tag{4.61}$$

<figure>
<img src="/GMX/4.9.png" alt="图4.9：异常二面角原理。环的面外弯曲（左），环的取代（中），四面体偏离（右）。在所有情况下，异常二面角 $\x$ 被定义为平面 $(i,j,k)$ 和 $(j,k,l)$ 之间的夹角。" />
<figcaption>图4.9：异常二面角原理。环的面外弯曲（左），环的取代（中），四面体偏离（右）。在所有情况下，异常二面角 <span class="math">\(\x\)</span> 被定义为平面 <span class="math">\((i,j,k)\)</span> 和 <span class="math">\((j,k,l)\)</span> 之间的夹角。</figcaption>
</figure>

### 4.2.12 异常二面角

异常二面角是为了保持平面基团（例如芳环）处于平面内，或者为了防止分子翻转成其镜像分子，见图4.9。

__异常二面角：简谐型__

最简单的异常二面角势是简谐势，曲线如图4.10。

$$V_{id}(\x_{ijkl}) = {1\over2}k_\x(\x_{ijkl}-\x_0)^2 \tag{4.62}$$

简谐势函数不连续，但由于不连续点选择在距离 $\x_0$ 为 $180^{\circ}$ 的位置，这种不连续性永远不会引出麻烦。 __注意__ ，在拓扑输入文件中，角度的单位为度，而力常数的单位为 $\text{kJ/mol/rad}^2$ 。

__异常二面角：周期型__

这种势函数等同于周期性的正常二面角（见下文）。将此种二面角类型（类型4）单独分类只是为了在参数部分和输出中将异常二面角和正常二面角区分开来。

<figure>
<img src="/GMX/4.10.png" alt="图4.10：异常二面角的势能" />
<figcaption>图4.10：异常二面角的势能</figcaption>
</figure>

### 4.2.13 正常二面角

对于正常的二面角相互作用，可以选择GROMOS的周期性函数或基于 $\cos\phi$ 的幂的多项式展开函数（被称为Ryckaert-Bellemans势）。这种选择使得二面角四个原子中的第一和第四个原子之间的特殊相互作用也被包含在内。

对周期性的GROMOS势，必须包含特殊的1-4 LJ-相互作用；对 __烷烃__ 的Ryckaert-Bellemans势，1-4相互作用必须从非键列表中排除。 __注意__: Ryckaert-Bellemans势也可在OPLS等力场中与1-4相互作用联合使用。因此，在这种情况下你不应该修改`pdb2gmx`生成的拓扑文件。

__正常二面角：周期型__

正常二面角的定义遵从IUPAC/IUB约定，其中, $\f$ 是面 $ijk$ 和面 $jkl$ 之间的夹角， __零__ 相应于 __顺式(cis)__ 构型($i$ 和 $l$ 处于面的同一侧)。GROMACS拓扑文件中有两类二面角函数类型。标准类型1的行为和其他的键相互作用类似。对某些力场，类型9很有用。当在`[dihedraltypes]`部分对同一原子类型定义了多个参数时，类型9可使多个势能函数自动用于在`[dihedral]`部分的一个单一的二面角上。

这种类型的势函数为

$$V_d(\phi_{ijkl})=k_\phi(1+\cos(n\phi-\phi_s)) \tag{4.63}$$

__正常二面角：Ryckaert-Bellemans势函数__

对烷烃，经常使用以下的正常二面角势（见图4.12）：

$$V_{rb}(\phi_{ijkl})=\sum_{n=0}^5 C_n(\cos(\psi))^n \tag{4.64}$$

其中， $\psi = \phi - 180^{\circ}$ 。

 __注意__ ：从一个约定到另一个约定的转换可以通过将每个系数 $C_n$ 乘上 ${-1}^n$ 。

常数C的一个示例在表4.1中给出。

<figure>
<img src="/GMX/4.11.png" alt="图4.11：正常二面角的原理（左，反式trans构型）和二面角势（右）" />
<figcaption>图4.11：正常二面角的原理（左，反式trans构型）和二面角势（右）</figcaption>
</figure>

<table><caption>表4.1：Ryckaert-Bellemans势的常数值(\(\text{kJ mol}^{-1}\))</caption>
<tr>
<td style="text-align:center;">C0  9.28</td>
<td style="text-align:center;">C2 -13.12</td>
<td style="text-align:center;">C4 26.24</td>
</tr>
<tr>
<td style="text-align:center;">C1 12.16</td>
<td style="text-align:center;">C3  -3.06</td>
<td style="text-align:center;">C5 -31.5</td>
</tr>
</table>

<figure>
<img src="/GMX/4.12.png" alt="图4.12：Ryckaert-Bellemans二面角势" />
<figcaption>图4.12：Ryckaert-Bellemans二面角势</figcaption>
</figure>

(__注意__: 使用这种势函数意味着排除了组成二面角的第一个和最后一个原子之间的LJ相互作用，并且 $\psi$ 的定义遵从“聚合物约定”($\psi_{trans} = 0$)。

RB二面角函数也可用于包含傅立叶二面角（见下文）：

$$V_{rb}(\phi_{ijkl})={1\over2}[F_1(1+\cos(\phi))+F_2(1-\cos(2\phi))+F_3(1+\cos(3\phi))+F_4(1-\cos(4\phi)) ] \tag{4.65}$$

由于存在等式 $\cos(2\phi)=2\cos^2(\phi)-1,  \cos(3\phi)=4\cos^3(\phi)-3\cos(\phi)$ 和 $\cos(4\phi)=8\cos^4(\phi)-8\cos^2(\phi)+1$ ，可以利用下面的方程将OPLS参数变换为Ryckaert-Bellemans参数

$$\begin{split}
C_0 &= F_2 +{1\over2}(F_1+F_3) \\
C_1 &= {1\over2}(-F_1+3F_3) \\
C_2 &= -F_2+4F_4 \\
C_3 &= -2F_3 \\
C_4 &= -4F_4 \\
C_5 &= 0
\end{split} \tag{4.66}$$

OPLS参数遵从蛋白质约定，而RB参数遵从聚合物约定（这导致 $\cos(\phi)$ 奇数次项前面的负号）。

__注意__ ：记得将文献中OPLS和RB参数的单位 __$\text{kcal mol}^{-1}$__ 转化为GROMACS中的单位 __$\text{kcal mol}^{-1}$__ 。

__正常二面角：傅立叶函数__

OPLS势能函数为傅立叶级数的前三或四次余弦项[87]。GROMACS中，四项函数为：

$$V_F(\phi_{ijkl})={1\over2}[C_1(1+\cos(\phi)) + C_2(1-\cos(2\phi)) + C_3(1+\cos(3\phi)) + C_4(1+\cos(4\phi))] \tag{4.67}$$

GROMACS在内部使用Ryckaert-Bellemans代码来计算傅立叶二面角（见上文），因为计算效率更高。

__注意__ ：记得将文献中OPLS参数的单位 __$\text{kcal mol}^{-1}$__ 转化为GROMACS中的单位 __$\text{kcal mol}^{-1}$__ 。

__正常二面角：限制扭转势__

非常类似于限制弯曲势（见4.2.7），限制扭转/二面角势的函数为：

$$V_{\text{ReT}}(\phi_i)={1\over2}k_\phi {(\cos\phi_i-\cos\phi_0)^2 \over \sin^2\phi_i} \tag{4.68}$$

这类函数具有 $\cos\phi$ 函数的优点（对 $\sin\phi$ 求导时不存在问题），并且能保持扭转角处于仅有的一个最小值。在这种情况下，因子 $\sin^2\phi$ 不会让二面角从[ $-180^{\circ}:0$ ]区间移到[ $0:180^{\circ}$ ]区间内，即，函数不能同时在 $-\phi_0$ 和 $+\phi_0$ 处取极大值，而只能在其中之一取极大值。由于这个原因，初始构型中所有的二面角的角度值都必须处于所需的角度区间内，并且平衡的 $\phi_0$ 值不应太靠近区间的端点（与4.2.7中所讲的限制弯曲势类似，推荐至少 $10^{\circ}$ 的差异）.

__正常二面角：组合弯曲-扭转势__

当形成二面角的四个粒子共线时（这种情况永远不会发生在原子尺度的模拟中，但可能出现在粗粒模拟中），扭转角及其势函数的计算会引起数值不稳定性。避免这一问题的一种方法是使用限制弯曲势（见4.2.7），以防止二面角达到 $180^{\circ}$ 。

另一种方式是忽略二面角不合理定义时的任何效应，通过将扭转势（余弦形式）与相邻弯曲角的弯曲势耦合为一个特殊形式，保持二面角的力和势函数的计算在整个角度范围内连续：

$$V_{\text{CBT}}(\theta_{i-1},\theta_i,\phi_i)=k_\phi \sin^3\theta_{i-1} \sin^3\theta_i \sum_{n=0}^4 a_n \cos^n \phi_i \tag{4.69}$$

这种组合的弯曲扭转（combined bending-torsion，CBT）势函数由文献[88]提出，用于聚合物熔融的模拟。文献[84]对此有详细的描述。

这种势函数有两个主要的优点：

- 它不仅取决于(第 $i-2, i-1, i$ 和 $i+1$ 号珠子之间的)二面角 $\phi_i$ ，而且也取决于由三个相邻的珠子(分别是 $i-2, i-1, i$ 和 $i-1, i, i+1$)形成的弯曲角 $\theta_{i-1}$ 和 $\theta_i$ 。当两个弯曲角中的任意一个接近 $180^{\circ}$ 时，由文献[89]尝试性地提出，并由文献[90]从理论上进行了讨论的两个 $\sin^3\theta$ 前因子抵消了扭转势和力。

- 通过表达为 $\cos\phi_i$ 的多项式形式，它也取决于 $\phi_i$ ，这避免了 $\phi = 0^{\circ}$ 或 $\phi = 180^{\circ}$ 时计算扭转力的奇异性。

这两种特性使得CBT势用于弯曲角存在弱约束的MD模拟时表现良好，甚至对于弯曲角和扭转角变化剧烈的拉伸/非平衡MD模拟也是如此。当使用CBT势时，相邻的 $$\theta_{i-1}$$ 和 $$\theta_i$$ 的弯曲势可以取任意形式，也可完全省略这两个角弯曲项($$\theta_{i-1}$$ 和 $$\theta_i$$)。图4.13显示了包含和不含 $\sin^3\theta$ 因子（分别为蓝色和灰色的曲线）的扭转势之间的区别。此外， $$V_{\text{CBT}}$$ 对笛卡尔变量的导数直接易懂：

$$\opar{V_{\text{CBT}}(\theta_{i-1},\theta_i\phi_i)}{\vec r_l} = \opar{V_{\text{CBT}}}{\theta_{i-1}}\opar{\theta_{i-1}}{\vec r_l} + \opar{V_{\text{CBT}}}{\theta_i}\opar{\theta_i}{\vec r_l} + \opar{V_{\text{CBT}}}{\phi_i}\opar{\phi_i}{\vec r_l} \tag{4.70}$$

CBT基于无多重性的余弦形式，因此它只在 $0^{\circ}$ 左右对称。为获得一个不对称的二面角分布（如在[$-180^{\circ}:180^{\circ}$]区间内只有一个最大值），应该使用标准的扭转势，如简谐角势或周期性的余弦势来代替CBT势。然而，这两种形式对于力的微分（ $1/\sin\phi$ ）和珠子的直线排列（ $\theta_i$ 或 $\theta_{i-1} = 0^{\circ}, 180^{\circ}$ ）都不方便。非 $\cos\phi$ 势与 $\sin^3\theta$ 因子的耦合并不能提高模拟的稳定性，因为在某些情况下 $\theta$ 和 $\phi$ 同时为 $180^{\circ}$ 。在此步的积分是可能的（由于扭转势的抵消），但下一步积分将是病态的（ $\theta$ 不是 $180^{\circ}$ 而 $\phi$ 非常接近 $180^{\circ}$ ）。

<figure>
<img src="/GMX/4.13.png" alt="图4.13：蓝色：组合弯曲扭转势的表面图(方程4.69，其中 $k=10 \text{kJ mol}^{-1},a_0 = 2.41, a_1 = -2.95, a_2 = 0.36, a_3 = 1.33$)，为简单起见，弯曲角相同($\theta_1=\theta_2=\theta$)。灰色：同样的扭转势函数但不含 $\sin^3\theta$ 项（Ryckaert-Bellemans型）。 $\phi$ 为二面角。" />
<figcaption>图4.13：蓝色：组合弯曲扭转势的表面图(方程4.69，其中 <span class="math">\(k=10 \text{kJ mol}^{-1},a_0 = 2.41, a_1 = -2.95, a_2 = 0.36, a_3 = 1.33\)</span>)，为简单起见，弯曲角相同(<span class="math">\(\theta_1=\theta_2=\theta\)</span>)。灰色：同样的扭转势函数但不含 <span class="math">\(\sin^3\theta\)</span> 项（Ryckaert-Bellemans型）。 <span class="math">\(\phi\)</span> 为二面角。</figcaption>
</figure>

### 4.2.14 表格式键合相互作用

为了有充分的灵活性，可通过用户提供的表格函数形式，对键，键角和二面角使用任何函数。它们包括：

$$\alg
V_b(r_{ij}) & =kf_n^b(r_{ij}) \tag{4.71} \\
V_a(\theta_{ijk}) &= k f_n^a(\theta_{ijk}) \tag{4.72} \\
V_d(\phi_{ijkl}) &= k f_n^d(\phi_{ijkl}) \tag{4.73}
\ealg$$

其中, $k$ 是以能量为单位的力常数, $f$ 是三次样条函数；详细信息见6.10.1。对每种相互作用，在拓扑信息中指定力常数 $k$ 和表格编号 $n$. 有两种不同类型的键，一种产生排除（类型8），一种不产生排除（类型9）。详情见表5.5。表格文件会被提供给`mdrun`程序。表格文件名和下划线后，加入字母“b”表示键，“a”表示角或“d”表示二面角和表格编号。例如，对一个 $n = 0$ 的键（并使用默认的表格文件名），将从文件`table_b0.xvg`中读取表格。如拓扑信息（表5.5）中具体介绍的那样，可简单地通过使用不同的 $n$ 值提供多个表格，并应用到恰当的键。表格文件的格式是分别为 $x, f(x), -f'(x)$ 的三列，其中 $x$ 必须是等间隔的。拓扑信息的输入要求列于表5.5。这些表格的设置如下：


__键__: $x$ 是以纳米(nm)为单位的距离。若模拟时距离超出表格长度，`mdrun`将显示错误消息并退出。

__角度__: $x$ 是以度为单位的角度。表格应从0开始直到并包括180度；导数以度为单位。

__二面角__: $x$ 是以度为单位的二面角。表格应从-180直到并包括180度，使用IUPAC/IUB约定，即零为顺式，导数以度为单位。
 
